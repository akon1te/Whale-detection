# Поиск аномалий в аудио данных
---
## Введение
В 2020 году вышла статья [1] о применении нейросетей для обнаружения северных гладких китов на наборе коротких аудиозаписей. Затем, в 2021 году появилась новая публикация [2], в которой исследователям удалось улучшить результаты при помощи стекинга из XGBoost моделей. Мы попытались добиться бóльшей точности и в представленном тексте кратко описываем проделанную нами работу.

---
## Датасет

Данные предоставлены миру авторами [1] и представляют собой набор небольших .wav аудиозаписей, фиксируемых пассивной акустической системой с 2015 года по 2019 год в южной части залива Святого Лаврентия. Разделены на две части - A и B, разница между которыми в основном в способе и месте записи аудио.

---
## Feature Engineering
Получение признаков основано на [2] и в целом повторяет все те же шаги и методы. 

Аудио - не самый типичный формат данных, требующий специальной числовой интерпретации. Мы использовали librosa и torchaudio для получения и обработки. Данные из аудизаписей мы получаем в виде пары (y, sr), где y - массив, отражающий изменение амплитуды звуковых волн, sr (sample rate) - частота дискретизации. По этим двум параметрам можно построить спектрограмму звукового сигнала:
<image src="images/spectrogram.png">
Так выглядит спектрограмма сигнала, на котором зафиксировано пение кита. Однако изменение амплитуды и частота дискретизации - не единственные признаки, которые можно получить из имеющихся данных.

##### Spectral Centroid

Такая величина вычисляется следующим образом: 

$$SpectralCentroid=\frac{\sum_{k}f(k)S(k)}{\sum_{k}S(k)},$$

где $S(k)$ - спектральное значение в интервале $k$, $f(k)$ - частота (в Гц) звука на интервале $k$. Такую величину можно интерпретировать как "центр масс".

<p align="center">
    <image src="images/spectral_centroid.png" width=550>
</p>

##### Spectral Rolloff
Представляет собо относительную частоту, в пределах которой сосредоточено 85% (по умолчанию) всей энергии спектра. 

<p align="center">
    <image src="images/spectral_rolloff.png" width=550>
</p>

##### Spectral Bandwidth

Данную величину можно описать как разница между верхними и нижними частотами в непрерывной полосе частот.

$$Spectral Bandwidth = \left(\sum_{k}S(k) (f(k)-SpectralCentroid)^{p}\right)^{\frac{1}{p}},$$

где $S(k)$ - спектральное значение в интервале $k$, $f(k)$ - частота звука в интервале $k$, $p$ - порядок.

<p align="center">
    <image src="images/spectral_bandwidth.png" width=400>
</p>

##### Mel-Frequency Cepstral Coefficients

Это представление краткосрочного спектра мощности звука, основанное на линейном косинусном преобразовании логарифмического спектра мощности по нелинейной мел-шкале частоты.

<p align="center">
    <image src="images/mfccs.png" width=400>
</p>

##### Chroma Feature

Является вектором признаков из 12 элементов, указывающий, сколько энергии каждого класса высоты тона {C, C#, D, D#, E, ..., B} присутствует в сигнале. Иными словами, он обеспечивает надежный способ описания меры сходства между разными аудиозаписями.

<p align="center">
    <image src="images/chroma.png" width=450>
</p>

##### Zero-Crossing Rate

Количество пересечений нуля в сегменте сигнала. Легко вычисляется по формуле:

$$ZCR=\frac{1}{T-1}\sum_{t=1}^{T-1}\mathbb{I}(s_{t}s_{t-1}),$$

где $T$ - длина всего сигнала, $s_t$ - отрезок сигнала длины $t$, $I$ - индикаторная функция.



>Все графики были сделаны на основе того же примера, на котором строилась спектрограмма, т.е. по аудиозаписи, на которой зафиксированы признаки пения северного гладкого кита.

---
## Градиентный бустинг
В [2] использовался стекинг (к которому мы вернемся позже) на основе XGBoost. Даже без стекинга бустинг выдавал вполне неплохой результат, так что мы решили попробовать сначала улучшить показатели метрик просто воспользовавшись другими алгоритмами схожей направленности: CatBoost, LightGBM, а также Gradient Boosted Tree и LogitBoost из OneDAL. Использовали разные методы подбора гиперпараметров (например, RandomizedSearchCV) и в итоге получили вот такие результаты:

<p align="center">
    <image src="images/1lvl_comparsion.png" width=650>
</p>

Мы также решили оценить скорость обучения каждого из алгоритмов и были весьма удивлены разнице в производительности у XGBoost, CatBoost с другими, в особенности LogitBoost. Получить показатели лучше XGBoost не удалось, однако ближе всех к ним подошел Gradient Boosted Tree из OneDAL.

---
## Стекинг
Это продолжение идеи, предложенной в [2], однако мы решили попробовать не только XGBoost, но и другие варианты бустинга: CatBoost, LightGBM. Также были опробованы Gradient Boosted Tree и LogitBoost из OneDAL. Были задействованы разные методы подбора гиперпараметров (например, RandomizedSearchCV) и опробованы разные комбинации перечисленных алгоритмов.

У нас получились следующие результаты:

<p align="center">
    <image src="images/stacking_results.png" width=650>
</p>

---
## CNN

Хоть изначально именно свёрточные сети и использовались в текущей задаче, мы всё равно решили их попробовать - построить несколько относительно слабых нейросетей и объединить в ансамбль.

Мы использовали свёрточные нейросети с тремя, пятью и семью слоями, для каждого из которых применялся дропаут, макс-пулинг и батч-нормализация. В качестве функции активации для всех свёрточных слоёв использовалась LeakyReLU. Кроме того, выход каждой сети передавался XGBoost. На вход каждой сети давалась мел-спектрограмма, а точнее её численные характеристики. В итоге мы имели вот такие результаты:

<p align="center">
    <image src="images/CNN_comparsion.png" width=300>
</p>

---
## Заключение

Лучше всего себя показал стекинг из XGBoost + CatBoost, превозшедший результаты как в [1], так и в [2] по каждой из метрик. Свёрточные нейронные сети дают результат значительно хуже, даже в виде ансамбля и не могут конкурировать с прерыдущим вариантом. 

---
## Библиография

[1] Kirsebom, O. S., Frazao, F., Simard, Y., Roy, N., Matwin, S., and Giard, S., “Performance of a deep neural network at detecting North Atlantic right whale upcalls”, <i>Acoustical Society of America Journal</i>, vol. 147, no. 4, pp. 2636–2646, 2020. doi:10.1121/10.0001132.

[2] Mikhail Salin and Alexander Ponomarenko , "Marine mammal calls detection in acoustic signals via gradient boosting model", Proc. Mtgs. Acoust. 44, 010001 (2021) https://doi.org/10.1121/2.0001476